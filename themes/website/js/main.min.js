var app={isTouchDevice:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},loadInlineJson:function(e){return!!document.getElementById(e)&&JSON.parse(document.getElementById(e).innerHTML)},trackAsyncPageView:function(e,t){"function"==typeof gtag&&gtag("event","page_view",{page_title:t,page_path:e})},setCookie:function(e,t,a,n){var i=new Date;i.setTime(i.getTime()+864e5*a),document.cookie=e+"="+t+";expires="+i.toUTCString()+";path=/"},getCookie:function(e){e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return e?e[2]:null},postRender:function(){var e=document.querySelectorAll("span.spoiler");for(i=0;i<e.length;++i){var t=document.createElement("a"),a=(t.innerHTML=e[i].dataset.label,t.href="#revealspoiler",t.onclick=function(e){e.preventDefault(),this.className="d-none",this.parentNode.querySelector("span").className=""},document.createElement("span")),n=(a.className="d-none",a.innerHTML=e[i].innerHTML,document.createElement("span"));n.appendChild(t),n.appendChild(a),e[i].parentNode.replaceChild(n,e[i])}},getOffset:function(e){e=e.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft}},getHashValue:function(e,t,a){if(!e||e.indexOf(t)<0)return!1;e=e.match(new RegExp("\\"+t+".*?(\\"+a+"|$)"));return!(!e||!e[0])&&e[0].replace(a,"")},addHashValue:function(e,t,a,n){return e=app.removeHashValue(e,t,a),n?e+t+n:e},removeHashValue:function(e,t,a){t=app.getHashValue(e=e||"#",t,a);return e.replace(t,"")}},MousePosition={x:0,y:0,capture:function(e){(e=e||window.event).pageX||e.pageY?(this.x=e.pageX,this.y=e.pageY):(e.clientX||e.clientY)&&(this.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop)}},PageStateService={_defaultUrl:null,_defaultHash:null,_popState:!1,_identifierCallback:!1,_defaultCallback:!1,_callback:!1,_ajaxResponses:{},init:function(){this.trigger(),window.onpopstate=function(e){e=e.state?e.state.id:null,e=PageStateService.getCallback(e);PageStateService._popState=!0,e&&e()}},trigger:function(){var e;this._identifierCallback&&(e=this._identifierCallback(),(e=this.getCallback(e))&&e())},setDefaultUrl:function(e){this._defaultUrl=e},setDefaultHash:function(e){this._defaultHash=e},isPopState:function(){return this._popState},setDefaultCallback:function(e){this._defaultCallback=e},setCallback:function(e){this._callback=e},setIdentifierCallback:function(e){this._identifierCallback=e},getCallback:function(e){return e?function(){PageStateService._callback&&PageStateService._callback(e)}:PageStateService._defaultCallback||!1},push:function(e,t){history.pushState({id:e,url:t},null,e||""),this._popState=!1,this.getCallback(e)()},replace:function(e,t){history.replaceState({id:e,url:t},null,e||""),this._popState=!1,this.getCallback(e)()},ajaxHandler:function(t,e,a,n,i){var o;this.hasAjaxResponse(t)?this.triggerAjaxResponse(t,n,i):((o=new XMLHttpRequest).open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onload=function(){var e;200<=this.status&&this.status<400?(e=JSON.parse(this.response),n(e),PageStateService.setAjaxResponse(t,e)):(i(),PageStateService.setAjaxResponse(t,!1))},o.onerror=function(){i(),PageStateService.setAjaxResponse(t,!1)},o.send(JSON.stringify(a)))},setAjaxResponse:function(e,t){this._ajaxResponses[e]=t},hasAjaxResponse:function(e){return void 0!==this._ajaxResponses[e]},triggerAjaxResponse:function(e,t,a){!1!==this._ajaxResponses[e]?t(this._ajaxResponses[e]):a()}},GameModeService={_currentId:null,_currentName:null,_stickyEnabled:!1,_switchCallback:null,currentId:function(){return this._currentId},currentName:function(){return this._currentName},init:function(e,t){this._stickyEnabled=e||!1,this._switchCallback=t||!1;var a,n=document.querySelectorAll(".dropdown-gamemodes .dropdown-menu a"),e=GameId&&0<GameId.length?window.localStorage.getItem("gamemode_"+GameId):null,t=!1;0<n.length&&e&&0<e.length&&0<(a=document.querySelectorAll('.dropdown-gamemodes .dropdown-menu a[data-id="'+e+'"]')).length&&(this.switchTo(a[0]),t=!0),0<n.length&&!t&&0<(a=document.querySelectorAll('.dropdown-gamemodes .dropdown-menu a[data-default="1"]')).length&&(this.switchTo(a[0]),t=!0),0<n.length&&!t&&this.switchTo(n[0]);for(var i=0;i<n.length;i++)n[i].addEventListener("click",function(e){e.preventDefault(),GameModeService.switchTo(this)});this._stickyEnabled&&this.prepareSticky()},prepareSticky:function(){var a,n,e;app.isTouchDevice()||(a=document.querySelector(".gamemodeselector"),(n=document.querySelector(".form-gamemodes"))&&((e=function(){var e=app.getOffset(a).top,t=n.classList.contains("fixed");e<=(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)?t||(a.style.height=a.clientHeight+"px",n.style.width=a.clientWidth+"px",n.classList.add("fixed")):(n.classList.remove("fixed"),n.style.width="auto",a.style.height="auto")})(),document.addEventListener("scroll",e),document.addEventListener("resize",function(){n.classList.contains("fixed")&&(n.style.width=a.clientWidth-30+"px")})))},switchTo:function(e){this._currentId=e.getAttribute("data-id"),this._currentName=e.querySelector(".name").innerText;var t=document.querySelectorAll(".dropdown-gamemodes button");if(0<t.length)for(var a=0;a<t.length;a++)t[a].setAttribute("data-id",this._currentId),t[a].setAttribute("data-name",this._currentName),t[a].innerHTML=e.innerHTML;GameId&&0<GameId.length&&window.localStorage.setItem("gamemode_"+GameId,this._currentId),this._switchCallback&&this._switchCallback()}},DetailService={_pageId:"page-detail",onPage:function(){return null!==document.getElementById(this._pageId)},init:function(){for(var e=document.querySelectorAll("ul.gamemodeshortcuts > li > a"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.preventDefault();e=e.target.getAttribute("data-id"),e=document.querySelector('.detail-gamemodes a.dropdown-item[data-id="'+e+'"]');e&&e.click()})},switchGameMode:function(){for(var e=GameModeService.currentId(),t=document.querySelectorAll("ul.gamemodecontent > li"),a=document.querySelectorAll('ul.gamemodecontent > li[data-gamemode="'+e+'"]'),n=0;n<t.length;n++)t[n].style.display="none",t[n].classList.remove("visible");for(n=0;n<a.length;n++)a[n].style.display="block",a[n].classList.add("visible");0!==a.length||(e=document.querySelector("ul.gamemodecontent > li.no-result"))&&(e.style.display="block",e.classList.add("visible"))}},EntityListService={_pageId:"page-entity-list",_pageTitle:null,_apiBaseUrl:"/api/entity",_modalSelector:"#detail-modal",onPage:function(){return null!==document.getElementById(this._pageId)},init:function(){if(this._pageTitle=document.title,0===document.querySelectorAll(this._modalSelector).length&&document.body.insertAdjacentHTML("beforeend",document.getElementById("modal-tpl").innerHTML),!app.isTouchDevice())for(var e=document.querySelectorAll("ul.resultlist li.resultitem a"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.preventDefault();var t=app.addHashValue(window.location.hash,"!","?",e.target.getAttribute("data-id")),e=e.target.getAttribute("href");PageStateService.push(t,e)});var a=this._modalSelector;document.querySelector(a).addEventListener("hidden.bs.modal",function(e){return PageStateService.isPopState()&&e.target.getAttribute("data-pop-state")?(e.target.setAttribute("data-pop-state",""),void PageStateService.replace(app.removeHashValue(window.location.hash,"!","?"))):void PageStateService.push(app.removeHashValue(window.location.hash,"!","?"))}),PageStateService.setIdentifierCallback(function(){var e=window.location.hash;return e&&0<e.indexOf("!")?e:null}),PageStateService.setDefaultCallback(function(){EntityListService.loadPageState(window.location.hash)}),PageStateService.setCallback(function(e){EntityListService.loadPageState(e)})},loadPageState:function(e){var t=app.getHashValue(e,"!","?");t?this.loadEntity(e,t):this.unloadEntity()},loadEntity:function(e,t){var a=this._apiBaseUrl,n=this._modalSelector,i={id:t.substring(1),path:window.location.pathname+"/"+t.substring(1)},o=document.querySelector(n),n=(o.querySelector(".modal-title").textContent="Loading...",o.querySelector(".modal-body").innerHTML=document.getElementById("loading-tpl").innerHTML,bootstrap.Modal.getInstance(o));(n||new bootstrap.Modal(o)).show(),PageStateService.ajaxHandler(t,a,i,function(e){if(document.title=e.name,o.querySelector(".modal-title").textContent=e.name,o.querySelector(".modal-body").innerHTML=e.body,app.trackAsyncPageView(e.url,e.name),app.postRender(),!app.isTouchDevice())for(var t=document.querySelectorAll(".modal-body div.attributes"),a=0;a<t.length;++a)new SimpleBar(t[a],CustomScrollbarOptions);DetailService.init(),GameModeService.init(!1,DetailService.switchGameMode)},function(){o.querySelector(".modal-title").textContent="Oops...",o.querySelector(".modal-body").innerHTML="Something went wrong. Please try again."})},unloadEntity:function(){var e=this._modalSelector,e=document.querySelector(e);e.classList.contains("show")&&(e.setAttribute("data-pop-state","true"),bootstrap.Modal.getInstance(e).hide()),e.querySelector(".modal-title").textContent="",e.querySelector(".modal-body").innerHTML="",document.title=this._pageTitle}},MapService={_pageId:"page-map-detail",_pageTitle:null,_apiBaseUrl:"/api/location",_modalSelector:"#detail-modal",_previewData:null,_previewId:"allocation-box",_previewSelector:"div#allocation-box",_isMouseEnabled:!0,onPage:function(){return null!==document.getElementById(this._pageId)},init:function(e){if(this._previewData=e,this._isMouseEnabled=!app.isTouchDevice(),this._pageTitle=document.title,this._isMouseEnabled&&(document.body.appendChild(document.createElement("div")).id=this._previewId),0===document.querySelectorAll(this._modalSelector).length&&document.body.insertAdjacentHTML("beforeend",document.getElementById("modal-tpl").innerHTML),this._isMouseEnabled,this._isMouseEnabled)for(var t=document.querySelectorAll(".map .map-rooms li"),a=0;a<t.length;a++)t[a].getAttribute("data-image")&&(t[a].getElementsByTagName("img")[0].src=t[a].getAttribute("data-image"),t[a].removeAttribute("data-image"));this._isMouseEnabled&&document.addEventListener("mousemove",function(e){MapService.movePreview(e)});for(var n=document.getElementsByTagName("area"),a=0;a<n.length;a++)this._isMouseEnabled&&(n[a].addEventListener("click",function(e){e.preventDefault();var t=app.addHashValue(window.location.hash,"!","?",e.target.getAttribute("data-id")),e=e.target.getAttribute("href");PageStateService.push(t,e)}),n[a].removeAttribute("title"),n[a].addEventListener("mouseover",function(e){MapService.toggle(e,!0,!0)}),n[a].addEventListener("mouseout",function(e){MapService.toggle(e,!1,!0)})),n[a].addEventListener("focus",function(e){MapService.toggle(e,!0)}),n[a].addEventListener("blur",function(e){MapService.toggle(e,!1)});e=this._modalSelector;document.querySelector(e).addEventListener("hidden.bs.modal",function(e){return PageStateService.isPopState()&&e.target.getAttribute("data-pop-state")?(e.target.setAttribute("data-pop-state",""),void PageStateService.replace(app.removeHashValue(window.location.hash,"!","?"))):void PageStateService.push(app.removeHashValue(window.location.hash,"!","?"))}),PageStateService.setIdentifierCallback(function(){var e=window.location.hash;return e&&(0<e.indexOf("!")||0<e.indexOf("?"))?e:null}),PageStateService.setDefaultCallback(function(){MapService.loadPageState(window.location.hash)}),PageStateService.setCallback(function(e){MapService.loadPageState(e)})},loadPageState:function(e){var t=app.getHashValue(e,"!","?"),a=app.getHashValue(e,"?","!");t?this.loadLocation(e,t):this.unloadLocation(),a?this.loadHighlightResult(e,a):this.unloadHighlightResult()},loadLocation:function(e,t){var a=this._apiBaseUrl,n=this._modalSelector,i={id:t.substring(1),path:window.location.pathname+"/"+t.substring(1)},o=document.querySelector(n),n=(o.querySelector(".modal-title").textContent="Loading...",o.querySelector(".modal-body").innerHTML=document.getElementById("loading-tpl").innerHTML,bootstrap.Modal.getInstance(o));(n||new bootstrap.Modal(o)).show(),PageStateService.ajaxHandler(t,a,i,function(e){document.title=e.name,o.querySelector(".modal-title").textContent=e.name,o.querySelector(".modal-body").innerHTML=e.body,app.trackAsyncPageView(e.url,e.name),app.postRender(),DetailService.init(),GameModeService.init(!1,DetailService.switchGameMode)},function(){o.querySelector(".modal-title").textContent="Oops...",o.querySelector(".modal-body").innerHTML="Something went wrong. Please try again."})},unloadLocation:function(){var e=this._modalSelector,e=document.querySelector(e);e.classList.contains("show")&&(e.setAttribute("data-pop-state","true"),bootstrap.Modal.getInstance(e).hide()),e.querySelector(".modal-title").textContent="",e.querySelector(".modal-body").innerHTML="",document.title=this._pageTitle},loadHighlightResult:function(e,t){var a={path:window.location.pathname,query:t.substring(1)};PageStateService.ajaxHandler(t,"/api/highlight-result",a,function(e){MapService.unloadHighlightResult();for(var t,a=document.getElementById("maphighlight"),n=(a.innerHTML=e.data,a.querySelectorAll(".item .btn-close")),i=0;i<n.length;i++)n[i].addEventListener("click",function(e){e.preventDefault();e=app.addHashValue(window.location.hash,"?","!",e.target.getAttribute("data-remove-query"));PageStateService.push(e)});for(t in e.references)for(var o=document.querySelectorAll('.map .map-rooms li[data-ref="'+t+'"] img'),i=0;i<o.length;i++){var l=o[i];l.setAttribute("data-src",l.src),l.src=e.references[t],l.parentNode.classList.add("hi")}},function(){})},unloadHighlightResult:function(){document.getElementById("maphighlight").innerHTML="";for(var e=document.querySelectorAll(".map .map-rooms li.hi img"),t=0;t<e.length;t++){var a=e[t];a.getAttribute("data-src")&&(a.src=a.getAttribute("data-src"),a.removeAttribute("data-src")),a.parentNode.classList.remove("hi")}},toggle:function(e,t,a){var n=e.target.getAttribute("data-ref"),n=document.querySelector('.map-rooms li[data-ref="'+n+'"]');n&&n.getAttribute("data-image")&&(n.findElementsByTagName("img")[0].src=n.getAttribute("data-image"),n.removeAttribute("data-image")),t?n.classList.add("on"):n.classList.remove("on"),a&&(t?(n=e.target.getAttribute("data-name"),a=e.target.getAttribute("data-location"),t=GameModeService.currentName(),e=GameModeService.currentId(),this.showPreview(a+e,n,t)):this.hidePreview())},showPreview:function(e,t,a){this._isMouseEnabled&&(t={locationName:t,gameModeName:a,contents:!!this._previewData&&this._previewData[e]||[]},a=document.getElementById("allocation-box-tpl").innerHTML,e=doT.template(a)(t),document.getElementById(this._previewId).innerHTML=e,document.getElementById(this._previewId).style.display="block")},hidePreview:function(){this._isMouseEnabled&&(document.getElementById(this._previewId).innerHTML="",document.getElementById(this._previewId).style.display="none")},movePreview:function(){var e,t,a,n,i,o,l,r;!this._isMouseEnabled||(e=document.getElementById(this._previewId))&&"block"===e.style.display&&(t=MousePosition.y+20,a=MousePosition.x+20,n=e.clientWidth,i=e.clientHeight,o=document.documentElement.clientWidth,l=document.documentElement.clientHeight,r=document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft,l+(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)<t+i+17&&(t=MousePosition.y-20-i),o+r<a+n+17&&(a=MousePosition.x-20-n),t<0&&(t=MousePosition.y+20),a<0&&(a=MousePosition.x+20),e.style.top=t+"px",e.style.left=a+"px")}},MapHighlightService={},CustomScrollbarOptions={autoHide:!1},GameId=null,mobileNavForm=(app.postRender(),app.isTouchDevice()&&document.body.classList.add("is-touch-device"),document.getElementById("form-mobile-nav")),pageJson=(mobileNavForm&&mobileNavForm.addEventListener("submit",function(e){e.preventDefault();e=e.target.querySelector("select");window.location.href=e[e.selectedIndex].value}),"true"!==app.getCookie("cookieconsent")&&document.getElementById("cookiebar-tpl")&&(document.body.insertAdjacentHTML("beforeend",document.getElementById("cookiebar-tpl").innerHTML),document.querySelector("#cookiebar button.action-close").addEventListener("click",function(e){e.preventDefault(),document.getElementById("cookiebar").style.display="none"},!1),document.querySelector("#cookiebar button.action-agree").addEventListener("click",function(e){e.preventDefault(),app.setCookie("cookieconsent","true",365),window.location.reload()},!1)),app.loadInlineJson("json-page"));if(pageJson&&pageJson.url&&PageStateService.setDefaultUrl(pageJson.url),pageJson&&pageJson.gameId&&(GameId=pageJson.gameId),EntityListService.onPage()&&EntityListService.init(),MapService.onPage()&&(app.isTouchDevice()||document.addEventListener("mousemove",function(e){MousePosition.capture(e)}),MapService.init(app.loadInlineJson("json-map-data")),GameModeService.init(!0)),DetailService.onPage()&&(DetailService.init(),GameModeService.init(!1,DetailService.switchGameMode)),PageStateService.init(),!app.isTouchDevice())for(var elems=document.querySelectorAll("div.releases, div.attributes, div.map-wrapper"),i=0;i<elems.length;++i)new SimpleBar(elems[i],CustomScrollbarOptions);!function(){for(var e=document.querySelectorAll(".togglemenubox"),t=0;t<e.length;++t){var a=e[t],n=a.querySelector(".card-header a");n&&n.addEventListener("click",function(e){e.preventDefault(),a.classList.toggle("expanded")},!1)}}();